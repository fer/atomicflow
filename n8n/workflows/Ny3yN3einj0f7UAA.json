{"createdAt":"2025-05-08T18:40:48.959Z","updatedAt":"2025-05-12T21:40:39.425Z","id":"Ny3yN3einj0f7UAA","name":"ðŸ·ï¸ XLS Webshop","active":false,"nodes":[{"parameters":{"respondWith":"allIncomingItems","options":{}},"type":"n8n-nodes-base.respondToWebhook","typeVersion":1.2,"position":[380,160],"id":"3ca31b1d-8803-412e-a58d-81893a22df8a","name":"Respond to Webhook"},{"parameters":{"httpMethod":"POST","path":"xls-webshop/api/v1/registry","responseMode":"responseNode","options":{}},"type":"n8n-nodes-base.webhook","typeVersion":2,"position":[-280,-120],"id":"b83cacaa-c2b6-4c8d-bfef-c90950c0c04d","name":"POST /api/v1/registry","webhookId":"5b9b95b7-4e04-4eed-9acd-b5ca7a187404"},{"parameters":{"operation":"append","documentId":{"__rl":true,"value":"1R3XKyzRsCK8u8JBJBbIqDfQe9mh_zODgZar7sg-LXQk","mode":"list","cachedResultName":"XLS Webshop","cachedResultUrl":"https://docs.google.com/spreadsheets/d/1R3XKyzRsCK8u8JBJBbIqDfQe9mh_zODgZar7sg-LXQk/edit?usp=drivesdk"},"sheetName":{"__rl":true,"value":672246945,"mode":"list","cachedResultName":"registry","cachedResultUrl":"https://docs.google.com/spreadsheets/d/1R3XKyzRsCK8u8JBJBbIqDfQe9mh_zODgZar7sg-LXQk/edit#gid=672246945"},"columns":{"mappingMode":"defineBelow","value":{"user_id":"={{ $json.user_id }}","product_id":"={{ $json.product_id }}","quantity":"={{ $json.quantity }}","total":"={{ $json.total }}","payment_id":"={{ $json.payment_id }}","timestamp":"={{ $json.timestamp }}","payment_code":"={{ $json.payment_id === 2 ? Array.from({ length: 6 }, () => 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789'.charAt(Math.floor(Math.random() * 62))).join('') : '' }}"},"matchingColumns":[],"schema":[{"id":"user_id","displayName":"user_id","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true},{"id":"product_id","displayName":"product_id","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true},{"id":"quantity","displayName":"quantity","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true},{"id":"total","displayName":"total","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true},{"id":"payment_id","displayName":"payment_id","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true},{"id":"timestamp","displayName":"timestamp","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true},{"id":"payment_code","displayName":"payment_code","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true}],"attemptToConvertTypes":false,"convertFieldsToString":false},"options":{}},"type":"n8n-nodes-base.googleSheets","typeVersion":4.5,"position":[160,-120],"id":"4c9efc6f-34e0-49f2-a695-15152dfc21d1","name":"Google Sheets1","credentials":{"googleSheetsOAuth2Api":{"id":"cqKrY7EMvYySUH2W","name":"Google Sheets account"}}},{"parameters":{"mode":"raw","jsonOutput":"={{ \n  Object.assign(\n    {}, \n    $json.body, \n    { \n      timestamp: new Date().toISOString().slice(0, 23).replace('T', ' ')\n    }\n  ) \n}}","options":{}},"type":"n8n-nodes-base.set","typeVersion":3.4,"position":[-60,-120],"id":"944ba8be-1c6d-49bc-9c86-958d32f2948f","name":"Edit Fields"},{"parameters":{"documentId":{"__rl":true,"value":"1R3XKyzRsCK8u8JBJBbIqDfQe9mh_zODgZar7sg-LXQk","mode":"list","cachedResultName":"XLS Webshop","cachedResultUrl":"https://docs.google.com/spreadsheets/d/1R3XKyzRsCK8u8JBJBbIqDfQe9mh_zODgZar7sg-LXQk/edit?usp=drivesdk"},"sheetName":{"__rl":true,"value":672246945,"mode":"list","cachedResultName":"registry","cachedResultUrl":"https://docs.google.com/spreadsheets/d/1R3XKyzRsCK8u8JBJBbIqDfQe9mh_zODgZar7sg-LXQk/edit#gid=672246945"},"filtersUI":{"values":[{"lookupColumn":"payment_code","lookupValue":"={{ $json.payment_code }}"}]},"options":{"returnFirstMatch":false}},"type":"n8n-nodes-base.googleSheets","typeVersion":4.5,"position":[380,-120],"id":"4fde8564-0077-4243-9e4c-b42d4f0bc645","name":"Get row number","credentials":{"googleSheetsOAuth2Api":{"id":"cqKrY7EMvYySUH2W","name":"Google Sheets account"}}},{"parameters":{"respondWith":"allIncomingItems","options":{"responseCode":200,"responseHeaders":{"entries":[{"name":"Content-Type","value":"application/json"},{"name":"Access-Control-Allow-Origin","value":"*"},{"name":"Access-Control-Allow-Methods","value":"GET, POST, OPTIONS"},{"name":"Access-Control-Allow-Headers","value":"Content-Type, Authorization"}]}}},"type":"n8n-nodes-base.respondToWebhook","typeVersion":1.2,"position":[820,-120],"id":"28d2fda6-899c-45a0-8a90-9fe8a11a4395","name":"Respond with Registry Completed"},{"parameters":{"documentId":{"__rl":true,"value":"1R3XKyzRsCK8u8JBJBbIqDfQe9mh_zODgZar7sg-LXQk","mode":"list","cachedResultName":"XLS Webshop","cachedResultUrl":"https://docs.google.com/spreadsheets/d/1R3XKyzRsCK8u8JBJBbIqDfQe9mh_zODgZar7sg-LXQk/edit?usp=drivesdk"},"sheetName":{"__rl":true,"value":"gid=0","mode":"list","cachedResultName":"products","cachedResultUrl":"https://docs.google.com/spreadsheets/d/1R3XKyzRsCK8u8JBJBbIqDfQe9mh_zODgZar7sg-LXQk/edit#gid=0"},"options":{"dataLocationOnSheet":{"values":{"rangeDefinition":"detectAutomatically"}}}},"type":"n8n-nodes-base.googleSheets","typeVersion":4.5,"position":[-60,160],"id":"096f0167-aa72-41e8-8706-13bd02e86cca","name":"Get Products","credentials":{"googleSheetsOAuth2Api":{"id":"cqKrY7EMvYySUH2W","name":"Google Sheets account"}}},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"loose","version":2},"conditions":[{"id":"395f63f0-a492-47d6-a3ec-eeb87163801d","leftValue":"={{ $json.active }}","rightValue":"={{ true }}","operator":{"type":"string","operation":"equals","name":"filter.operator.equals"}},{"id":"65cd50e9-ebed-470c-81fd-9764f785f26d","leftValue":"","rightValue":"","operator":{"type":"string","operation":"equals","name":"filter.operator.equals"}}],"combinator":"and"},"looseTypeValidation":true,"options":{}},"type":"n8n-nodes-base.filter","typeVersion":2.2,"position":[160,160],"id":"a7868d48-dc58-424d-81de-b1ded23b3ebb","name":"Filter Active Products"},{"parameters":{"content":"## API: Create Registry Entry\n","height":220,"width":1480},"type":"n8n-nodes-base.stickyNote","typeVersion":1,"position":[-360,-180],"id":"01b8c9fa-043f-47a0-aae8-efc3b81e86e8","name":"Sticky Note"},{"parameters":{"content":"## API: Get Active Products\n\n","height":220,"width":1020},"type":"n8n-nodes-base.stickyNote","typeVersion":1,"position":[-360,100],"id":"c2d727c6-4c0e-4bbb-9ee5-2a0be77c2e1a","name":"Sticky Note1"},{"parameters":{"assignments":{"assignments":[{"id":"4e26703f-6136-444e-b942-780047722512","name":"user_id","value":"={{ $json.user_id }}","type":"number"},{"id":"091f5acc-dc6b-46c8-937f-f7410766afcd","name":"payment_code","value":"={{ $json.payment_code }}","type":"string"},{"id":"5b0461b0-36d1-452e-a98a-946ff2a17776","name":"payment_id","value":"={{ $json.payment_id }}","type":"number"},{"id":"56326098-f429-46f9-adcc-515c27f3c8f3","name":"total","value":"={{ $json.total }}","type":"number"},{"id":"32819a4c-fdda-476b-b860-fb6fe4ad50bf","name":"timestamp","value":"={{ $json.timestamp }}","type":"string"}]},"options":{}},"type":"n8n-nodes-base.set","typeVersion":3.4,"position":[600,-120],"id":"8f64f5cd-fc1a-46f9-ac26-0b6144b4a80a","name":"Remove row & qty"},{"parameters":{"path":"xls-webshop/api/v1/products","responseMode":"responseNode","options":{}},"type":"n8n-nodes-base.webhook","typeVersion":2,"position":[-280,160],"id":"72e3b3c4-2f66-4bc2-801c-875cda38f460","name":"GET /api/v1/products","webhookId":"6dd6e84d-8caa-4666-b5a9-e21de00ffad8"},{"parameters":{"content":"## API: Validate member\n\n","height":380,"width":1580},"type":"n8n-nodes-base.stickyNote","typeVersion":1,"position":[-360,360],"id":"ae249c27-3c13-4595-90cb-6fde5777e5b0","name":"Sticky Note2"},{"parameters":{"content":"## todo\n\n- [ ] xls-webshop to global","height":280,"width":320},"type":"n8n-nodes-base.stickyNote","typeVersion":1,"position":[-740,-160],"id":"9ee714f5-e59f-481f-84dd-d845a8f87c28","name":"Sticky Note3"},{"parameters":{"httpMethod":"POST","path":"xls-webshop/api/v1/validate_member","responseMode":"responseNode","options":{}},"type":"n8n-nodes-base.webhook","typeVersion":2,"position":[-280,460],"id":"ff7edfcc-930c-4885-b09a-0735a41897dd","name":"POST /api/v1/validate_member","webhookId":"1dff6c08-2597-44da-a305-20644351ce33","notesInFlow":true,"notes":"validate_member"},{"parameters":{"documentId":{"__rl":true,"value":"1R3XKyzRsCK8u8JBJBbIqDfQe9mh_zODgZar7sg-LXQk","mode":"list","cachedResultName":"XLS Webshop","cachedResultUrl":"https://docs.google.com/spreadsheets/d/1R3XKyzRsCK8u8JBJBbIqDfQe9mh_zODgZar7sg-LXQk/edit?usp=drivesdk"},"sheetName":{"__rl":true,"value":52979391,"mode":"list","cachedResultName":"users","cachedResultUrl":"https://docs.google.com/spreadsheets/d/1R3XKyzRsCK8u8JBJBbIqDfQe9mh_zODgZar7sg-LXQk/edit#gid=52979391"},"options":{}},"type":"n8n-nodes-base.googleSheets","typeVersion":4.5,"position":[-60,460],"id":"6b6bc8dd-5387-4c45-a6b2-d8c2961be7d8","name":"Google Sheets","credentials":{"googleSheetsOAuth2Api":{"id":"cqKrY7EMvYySUH2W","name":"Google Sheets account"}}},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"loose","version":2},"conditions":[{"id":"edccbbd1-5517-4f4e-afe3-41c41c91b5ee","leftValue":"={{ $json.user_id }}","rightValue":"={{ $('POST /api/v1/validate_member').item.json.body.user_id }}","operator":{"type":"string","operation":"equals","name":"filter.operator.equals"}}],"combinator":"and"},"looseTypeValidation":true,"options":{}},"type":"n8n-nodes-base.filter","typeVersion":2.2,"position":[120,460],"id":"eca55771-2d08-4d8c-841c-99d6ce756afc","name":"Filter","alwaysOutputData":true},{"parameters":{"assignments":{"assignments":[{"id":"425ad757-2454-4726-8dde-fe5223e53584","name":"user_id","value":"={{ $json.user_id }}","type":"number"},{"id":"57ae38ee-f7d1-400e-9731-8174a56cf395","name":"nickname","value":"={{ $json.nickname }}","type":"string"}]},"options":{}},"type":"n8n-nodes-base.set","typeVersion":3.4,"position":[340,460],"id":"e10e109f-53f4-45c0-802b-4e69952ed032","name":"Edit Fields1"},{"parameters":{"options":{"responseCode":200,"responseHeaders":{"entries":[{"name":"Content-Type","value":"application/json"},{"name":"Access-Control-Allow-Origin","value":"*"},{"name":"Access-Control-Allow-Methods","value":"GET, POST, OPTIONS"},{"name":"Access-Control-Allow-Headers","value":"Content-Type, Authorization"}]}}},"type":"n8n-nodes-base.respondToWebhook","typeVersion":1.2,"position":[780,400],"id":"ea065cb1-1fd4-475a-84fd-13e3fd9b1063","name":"Respond to Webhook1"},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"46204f60-d99f-4141-9f5d-ec99bb79e090","leftValue":"={{ $json.nickname }}","rightValue":"={{null}}","operator":{"type":"string","operation":"notEquals"}}],"combinator":"and"},"options":{}},"type":"n8n-nodes-base.if","typeVersion":2.2,"position":[560,460],"id":"b46e8998-5bce-4ca2-9c23-d50f864241d9","name":"isNull"},{"parameters":{"respondWith":"allIncomingItems","options":{"responseCode":200,"responseHeaders":{"entries":[{"name":"Content-Type","value":"application/json"},{"name":"Access-Control-Allow-Origin","value":"*"},{"name":"Access-Control-Allow-Methods","value":"GET, POST, OPTIONS"},{"name":"Access-Control-Allow-Headers","value":"Content-Type, Authorization"}]}}},"type":"n8n-nodes-base.respondToWebhook","typeVersion":1.2,"position":[1000,560],"id":"7a711624-e2f9-459f-8039-6d4cff6165c3","name":"Respond to Webhook2"},{"parameters":{"assignments":{"assignments":[{"id":"4950cdb3-6eb0-47f0-8edf-058aa472f145","name":"error","value":"NOT_VALID_MEMBER","type":"string"}]},"options":{}},"type":"n8n-nodes-base.set","typeVersion":3.4,"position":[780,560],"id":"04d3d85d-a604-435f-926e-1f2a4bb3f743","name":"Error JSON"},{"parameters":{"content":"## API Specs \n\n### POST /api/v1/registry\n\nbody:\n```\n{\n \"user_id\": 1,\n \"product_id\": 1,\n \"quantity\": 2,\n \"total\": 50,\n \"payment_id\": 2\n}\n```\n\nResponse:\n```\n[\n  {\n    \"user_id\": 1,\n    \"payment_code\": \"7LRcwV\",\n    \"payment_id\": 2,\n    \"total\": 50,\n    \"timestamp\": \"2025-05-06 17:02:12\"\n  }\n]\n```\n\n### GET /api/v1/products\n\nResponse:\n```\n[\n  {\n    \"row_number\": 2,\n    \"active\": true,\n    \"product_id\": \"tag_1\",\n    \"name\": \"Producto 1\",\n    \"price\": 5.1,\n    \"image_url\": \"https://picsum.photos/200\"\n  },\n  {\n    \"row_number\": 3,\n    \"active\": true,\n    \"product_id\": \"tag_2\",\n    \"name\": \"Producto 2\",\n    \"price\": 4.7,\n    \"image_url\": \"https://picsum.photos/200\"\n  },\n  {\n    \"row_number\": 4,\n    \"active\": true,\n    \"product_id\": \"tag_3\",\n    \"name\": \"Producto 3\",\n    \"price\": 3,\n    \"image_url\": \"https://picsum.photos/200\"\n  },\n  {\n    \"row_number\": 7,\n    \"active\": true,\n    \"product_id\": \"tag_6\",\n    \"name\": \"Producto 6\",\n    \"price\": 5,\n    \"image_url\": \"https://picsum.photos/200\"\n  }\n]\n```\n\n### POST /api/v1/validate_member\n \nbody\n```\n{\n   \"user_id\": 12\n}\n```\n\nResponse Fail:\n\n```\n[\n  {\n    \"error\": \"NOT_VALID_MEMBER\"\n  }\n]\n```\n\nResponse Success:\n\n```\n[\n{ \"user_id\":  1,\n  \"nickname\": \"mabel\"\n}\n]\n```","height":1820,"width":840},"type":"n8n-nodes-base.stickyNote","typeVersion":1,"position":[-1260,180],"id":"a65f21e7-cd9d-4caa-ba06-ae77e161c17f","name":"Sticky Note4"}],"connections":{"POST /api/v1/registry":{"main":[[{"node":"Edit Fields","type":"main","index":0}]]},"Google Sheets1":{"main":[[{"node":"Get row number","type":"main","index":0}]]},"Edit Fields":{"main":[[{"node":"Google Sheets1","type":"main","index":0}]]},"Get row number":{"main":[[{"node":"Remove row & qty","type":"main","index":0}]]},"Get Products":{"main":[[{"node":"Filter Active Products","type":"main","index":0}]]},"Filter Active Products":{"main":[[{"node":"Respond to Webhook","type":"main","index":0}]]},"Remove row & qty":{"main":[[{"node":"Respond with Registry Completed","type":"main","index":0}]]},"GET /api/v1/products":{"main":[[{"node":"Get Products","type":"main","index":0}]]},"POST /api/v1/validate_member":{"main":[[{"node":"Google Sheets","type":"main","index":0}]]},"Google Sheets":{"main":[[{"node":"Filter","type":"main","index":0}]]},"Filter":{"main":[[{"node":"Edit Fields1","type":"main","index":0}]]},"Edit Fields1":{"main":[[{"node":"isNull","type":"main","index":0}]]},"isNull":{"main":[[{"node":"Respond to Webhook1","type":"main","index":0}],[{"node":"Error JSON","type":"main","index":0}]]},"Error JSON":{"main":[[{"node":"Respond to Webhook2","type":"main","index":0}]]}},"settings":{"executionOrder":"v1"},"staticData":null,"meta":null,"pinData":{},"versionId":"0756625d-ebda-40c0-92ba-61ea57b0032b","triggerCount":3,"tags":[]}